# Copyright (C) 1999, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2011,
# 2012, 2013 Free Software Foundation, Inc.
#
# Copyright (C) 2013, 2014 Romain Garbi (DarkBatcher)
# 
# This file is part of GNU libmatheval
# 
#  GNU libmatheval is free software: you can redistribute it and/or
#  modify it under the terms of the GNU General Public License as
#  published by the Free Software Foundation, either version 3 of the
#  License, or (at your option) any later version.
#
# GNU libmatheval is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GNU libmatheval.  If not, see
# <http://www.gnu.org/licenses/>.
#

OBJ=	./lib/error.o ./lib/matheval.o ./lib/node.o \
	./lib/scanner.o ./lib/parser.o ./lib/symbol_table.o ./lib/xmalloc.o \
	./lib/xmath.o

# setup includes
INCLUDE_FILE=../include/matheval.h
ORIGIN_FILE=./lib/matheval.h

# build filenames
TARGET=../lib/libmatheval.a

CC=@CC@
CFLAGS=-Ilib @CFLAGS@ -DHAVE_CONFIG_H

YACC=@YACC@
YFLAGS=-p evaluator_ -d

LEX=@LEX@
LFLAGS=-P evaluator_

all : $(TARGET) $(INCLUDE_FILE)

# build the lib
$(TARGET): $(OBJ)
	ar -r -s $@ $(OBJ)

# installation of header
$(INCLUDE_FILE): $(ORIGIN_FILE)
	cp $(ORIGIN_FILE) $(INCLUDE_FILE)

clean:
	for i in $(OBJ); do rm -f $$i ; done;

.PHONY: clean

.SUFFIXES: .o
			
# build C files
.c.o:
	$(CC) $(CFLAGS) -o $@ -c $< 

# build YACC files			
./lib/parser.o: ./lib/parser.y
	$(YACC) $(YFLAGS) -o ./lib/parser.y.c ./lib/parser.y 
	$(CC) $(CFLAGS) -o ./lib/parser.o -c ./lib/parser.y.c 
	rm -f ./lib/parser.y.c
 
# build LEX files
./lib/scanner.o: ./lib/parser.o ./lib/scanner.l
	$(LEX) -o ./lib/scanner.l.c $(LFLAGS) ./lib/scanner.l 
	$(CC) $(CFLAGS) -o ./lib/scanner.o -c ./lib/scanner.l.c
	rm -f ./lib/scanner.l.c


